!function (o) {
    function i(i) {//handle next and previous click
        function e() {//e function
            function i(o) {//remove loading panel
                d.html(o), o.show(), d.removeClass("loading")
            }

            var e = o(this),
                t = parseInt(d.css("borderLeftWidth")),
                n = u - 2 * t,
                a = v - 2 * t,
                h = e.width(),
                l = e.height();
            if (h == d.width() && n >= h && l == d.height() && a >= l) return void i(e);
            if (h > n || l > a) {
                var r = l > a ? a : l,
                    c = h > n ? n : h;
                c / h >= r / l ? (e.width(Math.round(h * r / l)), e.height(r)) : (e.width(c), e.height(Math.round(l * c / h)))
            }
            d.animate({
                width: e.width(),
                height: e.height(),
                marginTop: -(e.height() / 2) - t,
                marginLeft: -(e.width() / 2) - t
            }, 100, function () {
                i(e)
            })
        }//end e function

        i && i.preventDefault();
        var t = o(this),
            n = t.attr("href"),
            id = t.attr("id");
        if (n) {
            o("#zoom .previous, #zoom .next").show(), t.hasClass("zoom") && o("#zoom .previous, #zoom .next").hide(), c || (c = !0, l.show(), h.addClass("zoomed"));
            var a = o(new Image).hide().css({
                width: "auto"
            });
            h.append(a), d.html("").delay(500).addClass("loading"), d.prepend(r), a.load(e).attr("src", n), s = t,
                //$('.download').attr("href",'https://e-service-application.herokuapp.com/api/web/image/download/'+id),
                $('.download').attr('href', imageUrl + '/download/' + id),
                $('.delete').attr('href', imageUrl + '/delete/' + id),
                $('.delete').attr('id', id)
            //$('.delete').attr("href",'https://e-service-application.herokuapp.com/api/web/image/delete/'+id)
        }
    }

    function e() {//previeus
        var i = s.parent("div").prev();
        0 == i.length && (i = o(".gallery div:last-child")), i.find("a").trigger("click")
    }

    function t() {//next
        var i = s.parent("div").next();
        0 == i.length && (i = o(".gallery div:first-child")), i.children("a").trigger("click")
    }

    function n(o) {//close
        o && o.preventDefault(), c = !1, s = null, l.hide(), h.removeClass("zoomed"), d.empty()
        $('.gallery').empty();
        $('#zoom').remove();
    }

    function a() {//resize image width height
        u = o(window).width(), v = o(window).height()
    }

    function download() {
        var url = $(".download").attr('href');
        console.log(url);
        window.location = url;
    }

    function add() {
        var callback = function (imgs) {
            for (var index = 0; index < imgs.length; index++)
                $(".zoom, .gallery #" + imgs[index]).on("click", i);
        }
        swal({
            html: '<br/><div class="form-group">' +
            '<div class="imgupload panel panel-default">' +
            '<div class="panel-heading clearfix">' +
            '<h3 class="panel-title pull-left">Upload images</h3></div>' +
            '<div class="file-tab panel-body">' +
            '<input type="file" id="uploads" name="files[]" accept="image/*" multiple/>' +
            '<div id="view" style="margin-top: 5px;float: left"></div>' +
            '</div>' +
            '</div>' +
            '</div>',
            allowEscapeKey: false,
            showCloseButton: true,
            confirmButtonText: 'Submit',
            showLoaderOnConfirm: true,
            preConfirm: function () {
                return new Promise(function (resolve, reject) {
                    setTimeout(function () {
                        $.fn.addMoreImage($('.gallery').attr('id'), reject, callback);
                    }, 4000)
                })
            },
            allowOutsideClick: false
        }).catch(swal.noop);

        $("#uploads").on("change", function (e) {
            var files = e.target.files;
            var filesLength = files.length;
            for (var i = 0; i < filesLength; i++) {
                var file = files[i];
                arrayImage.push(file);
                console.log(arrayImage);
                console.log($("#uploads").prop("files"));
                var fileReader = new FileReader();
                fileReader.fileName = file.name;
                fileReader.onload = (function (e) {
                    $("<div class='img-wrap'><span class='close' name='" + e.target.fileName + "'>&times;</span>" +
                        "<img class='img-thumbnail' src=\"" + e.target.result +
                        "\" style='height:100px' title=\"" + e.target.fileName + "\"/>" +
                        "</div>").appendTo($("#view"));
                    $(".close").click(function () {
                        for (var index = 0; index < arrayImage.length; index++) {
                            var name = $(this).attr("name");
                            if (arrayImage[index].name === name) {
                                arrayImage.splice(index, 1);
                                console.log(arrayImage);
                                console.log($("#uploads").prop("files"));
                                console.log("file ===>>> " + name + " has been removed!");
                                break;
                            }
                        }
                        $(this).parent(".img-wrap").remove();
                    });
                });
                fileReader.readAsDataURL(file);
            }
        });
    }

    function remove() {
        var func = function () {
            var url = $('.delete').attr('href');
            var id = $('.delete').attr('id');
            $.ajax({
                type: 'GET',
                url: url,
                success: function (response) {
                    for (var i = 0; i < images.length; i++) {
                        if (id == images[i]) {
                            images.splice(i, 1);
                            $("#" + id).parent().remove();
                            console.log("====>>> Remain image" + images.length);
                            console.log(images);
                            break;
                        }
                    }
                    if ($(".gallery a").length > 0) {
                        $("#zoom .next").click();
                    } else {
                        $("#zoom .close").click();
                    }
                    console.log(response);
                },
                error: function (response) {
                    swal('error!', 'error').catch(swal.noop);
                    ;
                    console.log(response);
                }
            });
        }
        $.fn.confirmDelete(func);
    }

    var h = o("body");
    h.append('<div id="zoom"><a class="add" title="add image"><span class="glyphicon glyphicon-plus"></span></a><a class="delete" title="delete image"><span class="glyphicon glyphicon-trash"></span></a><a class="download" title="download image"><span class="glyphicon glyphicon-download-alt"></span></a><a class="close"></a><a href="#previous" class="previous"></a><a href="#next" class="next"></a><div class="content loading"></div></div>');
    var l = o("#zoom").hide(),
        d = o("#zoom .content"),
        r = '<div class="overlay"></div>',
        c = !1,
        s = null,
        u = o(window).width(),
        v = o(window).height();
    !function () {
        l.on("click", function (i) {
            i.preventDefault(), "zoom" == o(i.target).attr("id") && n()
        }), o("#zoom .close").on("click", n), o("#zoom .previous").on("click", e), o("#zoom .next").on("click", t), o("#zoom .download").on("click", download), o("#zoom .delete").on("click", remove), o("#zoom .add").on("click", add), o(document).keydown(function (o) {
            s && ((38 == o.which || 40 == o.which) && o.preventDefault(), 27 == o.which && n(), 37 != o.which || s.hasClass("zoom") || e(), 39 != o.which || s.hasClass("zoom") || t())
        }), o(".gallery a").length > 0, o(".zoom, .gallery a").on("click", i)
    }(),
        function () {
            o(window).on("resize", a)
        }(),
        function () {
            o(window).on("mousewheel DOMMouseScroll", function (o) {
                s && (o.stopPropagation(), o.preventDefault(), o.cancelBubble = !1)
            })
        }()
}(jQuery);